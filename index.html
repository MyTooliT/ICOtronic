<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ICOtronic Package Documentation</title>
  <meta name="description" content="Library and scripts for the ICOtronic system" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="ICOtronic Package Documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Library and scripts for the ICOtronic system" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ICOtronic Package Documentation" />
  
  <meta name="twitter:description" content="Library and scripts for the ICOtronic system" />
  

<meta name="author" content="MyTooliT" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#hardware"><i class="fa fa-check"></i><b>1.1.1</b> Hardware</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#software"><i class="fa fa-check"></i><b>1.1.2</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#install"><i class="fa fa-check"></i><b>1.2</b> Install</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#install-the-package-using-windows-terminal"><i class="fa fa-check"></i><b>1.2.1</b> Install the Package Using Windows Terminal</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#install-the-development-version-of-icotronic"><i class="fa fa-check"></i><b>1.2.2</b> Install the Development Version of ICOtronic</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#data-collection"><i class="fa fa-check"></i><b>2</b> Data Collection</a>
<ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#sensor-node-identifiers"><i class="fa fa-check"></i><b>2.1</b> Sensor Node Identifiers</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#collecting-data"><i class="fa fa-check"></i><b>2.2</b> Collecting Data</a></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#measurement-data"><i class="fa fa-check"></i><b>2.3</b> Measurement Data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path=""><a href="#adding-custom-metadata"><i class="fa fa-check"></i><b>2.3.1</b> Adding Custom Metadata</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#tutorials"><i class="fa fa-check"></i><b>3</b> Tutorials</a>
<ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#changing-configuration-values"><i class="fa fa-check"></i><b>3.1</b> Changing Configuration Values</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#icon-cli-tool"><i class="fa fa-check"></i><b>3.2</b> ICOn CLI Tool</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#help"><i class="fa fa-check"></i><b>3.2.1</b> Help</a></li>
<li class="chapter" data-level="3.2.2" data-path=""><a href="#listing-available-sensor-nodes"><i class="fa fa-check"></i><b>3.2.2</b> Listing Available Sensor Nodes</a></li>
<li class="chapter" data-level="3.2.3" data-path=""><a href="#collecting-measurement-data"><i class="fa fa-check"></i><b>3.2.3</b> Collecting Measurement Data</a></li>
<li class="chapter" data-level="3.2.4" data-path=""><a href="#tutorials:section:sth-renaming"><i class="fa fa-check"></i><b>3.2.4</b> Renaming a Sensor Node</a></li>
<li class="chapter" data-level="3.2.5" data-path=""><a href="#opening-the-user-configuration"><i class="fa fa-check"></i><b>3.2.5</b> Opening the User Configuration</a></li>
<li class="chapter" data-level="3.2.6" data-path=""><a href="#stu-commands"><i class="fa fa-check"></i><b>3.2.6</b> STU Commands</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#code-examples"><i class="fa fa-check"></i><b>4</b> Code Examples</a></li>
<li class="chapter" data-level="5" data-path=""><a href="#virtualization"><i class="fa fa-check"></i><b>5</b> Virtualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#windows-subsystem-for-linux-2"><i class="fa fa-check"></i><b>5.1</b> Windows Subsystem for Linux 2</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#containerization"><i class="fa fa-check"></i><b>6</b> Containerization</a>
<ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#docker-on-linux"><i class="fa fa-check"></i><b>6.1</b> Docker on Linux</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path=""><a href="#creating-a-docker-image"><i class="fa fa-check"></i><b>6.1.1</b> Creating a Docker Image</a></li>
<li class="chapter" data-level="6.1.2" data-path=""><a href="#building-the-docker-image"><i class="fa fa-check"></i><b>6.1.2</b> Building the Docker Image</a></li>
<li class="chapter" data-level="6.1.3" data-path=""><a href="#using-icotronic-in-the-docker-container"><i class="fa fa-check"></i><b>6.1.3</b> Using ICOtronic in the Docker Container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path=""><a href="#troubleshooting"><i class="fa fa-check"></i><b>7</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="7.1" data-path=""><a href="#import-errors"><i class="fa fa-check"></i><b>7.1</b> Import Errors</a></li>
<li class="chapter" data-level="7.2" data-path=""><a href="#insufficient-rights"><i class="fa fa-check"></i><b>7.2</b> Insufficient Rights</a></li>
<li class="chapter" data-level="7.3" data-path=""><a href="#introduction:section:unable-to-locate-hdf5"><i class="fa fa-check"></i><b>7.3</b> Unable to Locate HDF5</a></li>
<li class="chapter" data-level="7.4" data-path=""><a href="#hdf5-library-not-loaded"><i class="fa fa-check"></i><b>7.4</b> HDF5 Library Not Loaded</a></li>
<li class="chapter" data-level="7.5" data-path=""><a href="#unable-to-open-openblas-library"><i class="fa fa-check"></i><b>7.5</b> Unable to open OpenBLAS library</a></li>
<li class="chapter" data-level="7.6" data-path=""><a href="#unknown-command"><i class="fa fa-check"></i><b>7.6</b> Unknown Command</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path=""><a href="#development"><i class="fa fa-check"></i><b>8</b> Development</a>
<ul>
<li class="chapter" data-level="8.1" data-path=""><a href="#install-1"><i class="fa fa-check"></i><b>8.1</b> Install</a></li>
<li class="chapter" data-level="8.2" data-path=""><a href="#style"><i class="fa fa-check"></i><b>8.2</b> Style</a></li>
<li class="chapter" data-level="8.3" data-path=""><a href="#tests"><i class="fa fa-check"></i><b>8.3</b> Tests</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path=""><a href="#code-checks"><i class="fa fa-check"></i><b>8.3.1</b> Code Checks</a></li>
<li class="chapter" data-level="8.3.2" data-path=""><a href="#automatic-tests"><i class="fa fa-check"></i><b>8.3.2</b> Automatic Tests</a></li>
<li class="chapter" data-level="8.3.3" data-path=""><a href="#manual-tests"><i class="fa fa-check"></i><b>8.3.3</b> Manual Tests</a></li>
<li class="chapter" data-level="8.3.4" data-path=""><a href="#combined-checks-tests"><i class="fa fa-check"></i><b>8.3.4</b> Combined Checks &amp; Tests</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path=""><a href="#development:section:release"><i class="fa fa-check"></i><b>8.4</b> Release</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ICOtronic Package Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">ICOtronic Package Documentation</h1>
<p class="author"><em>MyTooliT</em></p>
</div>
<div id="introduction" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>ICOtronic is a <a href="https://pypi.org/project/icotronic">Python library</a> (based on <a href="https://pypi.org/project/python-can/"><code>python-can</code></a>)
for the <a href="https://www.mytoolit.com/ICOtronic/">ICOtronic system</a>. The main purpose of the software is <strong>data collection</strong>:</p>
<ul>
<li>directly <a href="https://icotronic.readthedocs.io">via the API</a> or</li>
<li>the script <a href="#icon-cli-tool"><code>icon</code></a></li>
</ul>
<p>The software reads data from the Stationary Transceiver Unit (STU) via CAN using the <a href="https://mytoolit.github.io/Documentation/#mytoolit-communication-protocol">MyTooliT protocol</a>. The STU itself reads from and writes data to a sensor node via Bluetooth.</p>
<div id="requirements" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Requirements<a href="#requirements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hardware" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Hardware<a href="#hardware" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to use the ICOtronic system you need at least:</p>
<ul>
<li><p>a <a href="https://www.peak-system.com">PCAN adapter</a>:</p>
<p><img src="Documentation/Pictures/PCAN.jpg" alt="PCAN Adapter" /></p>
<p>including:</p>
<ul>
<li><p>power injector, and</p></li>
<li><p>power supply unit (for the power injector):</p>
<p><img src="Documentation/Pictures/Power-Injector.jpg" alt="Power Injector" /></p></li>
</ul>
<blockquote>
<p><strong>Note:</strong> Other <a href="https://python-can.readthedocs.io/en/stable/interfaces.html">CAN adapters supported by python-can</a> should work as well. However, you need to update the <a href="#changing-configuration-values">configuration</a> for the CAN connection accordingly.</p>
</blockquote></li>
<li><p>a <a href="https://www.mytoolit.com/ICOtronic/">Stationary Transceiver Unit</a>:</p>
<p><img src="https://cdn.bitrix24.de/b5488381/landing/5fa/5fa2ce04fd1326e07bf39866e44f4e61/IMG_6338_2x.jpg" alt="STU" width="400"></p></li>
<li><p>a sensor node, such as a <a href="https://www.mytoolit.com/ICOtronic/">Sensory Tool Holder</a>:
<img src="https://cdn.bitrix24.de/b5488381/landing/cbe/cbe07df56cea688299533819c1e8a8d3/IMG_6350_2x_2x.jpg" alt="Sensory Tool Holder" width="400"></p></li>
</ul>
<div id="setup" class="section level4 hasAnchor" number="1.1.1.1">
<h4><span class="header-section-number">1.1.1.1</span> Setup<a href="#setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Connect the power injector
<ol style="list-style-type: decimal">
<li>to the PCAN adapter, and</li>
<li>the power supply unit.</li>
</ol></li>
<li>Connect the USB connector of the PCAN adapter to your computer.</li>
<li>Make sure that your sensor node (SHA/STH/SMH) is connected to a power source. For an STH this usually means that you should check that the battery is (fully) charged.</li>
</ol>
</div>
</div>
<div id="software" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Software<a href="#software" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="python" class="section level4 hasAnchor" number="1.1.2.1">
<h4><span class="header-section-number">1.1.2.1</span> Python<a href="#python" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the currently supported Python versions, please take a look the ‚ÄúMeta‚Äù section of the <a href="https://pypi.org/project/icotronic/">ICOtronic package on the Python Package Index</a> (PyPI). We recommend you use a current 64-bit version of Python.</p>
<p>You can download Python <a href="https://www.python.org/downloads">here</a>. When you install the software, please do not forget to enable the checkbox <strong>‚ÄúAdd Python to PATH‚Äù</strong> in the setup window of the installer.</p>
</div>
<div id="pcan-driver" class="section level4 hasAnchor" number="1.1.2.2">
<h4><span class="header-section-number">1.1.2.2</span> PCAN Driver<a href="#pcan-driver" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To communicate with the STU you need a driver that works with the PCAN adapter. The text below describes how to install/enable this driver on</p>
<ul>
<li><a href="#introduction:section:pcan-driver:linux">Linux</a>,</li>
<li><a href="#introduction:section:pcan-driver:macos">macOS</a>, and</li>
<li><a href="#introduction:section:pcan-driver:windows">Windows</a>.</li>
</ul>
<div id="introduction:section:pcan-driver:linux" class="section level5 hasAnchor" number="1.1.2.2.1">
<h5><span class="header-section-number">1.1.2.2.1</span> Linux<a href="#introduction:section:pcan-driver:linux" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>You need to make sure that your CAN adapter is available via the <a href="https://en.wikipedia.org/wiki/SocketCAN">SocketCAN</a> interface.</p>
<p>The following steps describe one possible option to configure the CAN interface on (<a href="https://getfedora.org">Fedora</a>, <a href="https://ubuntu.com">Ubuntu</a>) Linux <strong>manually</strong>.</p>
<ol style="list-style-type: decimal">
<li><p>Connect the CAN adapter to the computer that runs Linux (or alternatively a Linux VM)</p></li>
<li><p>Check the list of available interfaces:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">networkctl</span> list</span></code></pre></div>
<p>The command output should list the CAN interface with the name <code>can0</code></p></li>
<li><p>Configure the CAN interface with the following command:</p>
<pre><code>sudo ip link set can0 type can bitrate 1000000</code></pre></li>
<li><p>Bring up the CAN interface</p>
<pre><code>sudo ip link set can0 up</code></pre></li>
</ol>
<p>You can also configure the CAN interface <strong>automatically</strong>. For that purpose please store the following text:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">can*</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="kw">[CAN]</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="dt">BitRate</span><span class="ot">=</span><span class="dv">1000000</span></span></code></pre></div>
<p>in a file called <code>/etc/systemd/network/can.network</code>. Afterwards enable <code>networkd</code> and reload the configuration with the commands:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable systemd-networkd</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart systemd-networkd</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># Note: The command `networkctl reload` only works in systemd 244 or newer</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">sudo</span> networkctl reload <span class="kw">||</span> <span class="fu">sudo</span> systemctl reload systemd-networkd</span></code></pre></div>
<p>You can check the status of the CAN connection with the command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">networkctl</span> list</span></code></pre></div>
<p>If everything works as expected, then the output of the command should look similar to the text below:</p>
<pre><code>IDX LINK   TYPE     OPERATIONAL SETUP
  ‚Ä¶
  7 can0   can      carrier     configured</code></pre>
<p><strong>Sources</strong>:</p>
<ul>
<li><a href="https://askubuntu.com/questions/1082277/socketcan-device-on-ubuntu-core">SocketCAN device on Ubuntu Core</a></li>
<li><a href="https://github.com/linux-can/can-utils/issues/68#issuecomment-584505426">Question: How can I automatically bring up CAN interface using netplan?</a></li>
<li><a href="https://wiki.ubuntuusers.de/systemd/networkd/">networkd ‚Ä∫ systemd ‚Ä∫ Wiki ‚Ä∫ ubuntuusers</a></li>
</ul>
</div>
<div id="introduction:section:pcan-driver:macos" class="section level5 hasAnchor" number="1.1.2.2.2">
<h5><span class="header-section-number">1.1.2.2.2</span> macOS<a href="#introduction:section:pcan-driver:macos" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>On macOS you can use the <a href="https://github.com/mac-can/PCBUSB-Library">PCBUSB</a> library to add support for the PCAN adapter. For more information on how to install this library, please take a look at the issue <a href="https://github.com/mac-can/PCBUSB-Library/issues/10#issuecomment-1188682027">‚ÄúHow to install the PCBUSB-Library on Mac‚Äù</a>.</p>
</div>
<div id="introduction:section:pcan-driver:windows" class="section level5 hasAnchor" number="1.1.2.2.3">
<h5><span class="header-section-number">1.1.2.2.3</span> Windows<a href="#introduction:section:pcan-driver:windows" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>You can find the download link for the PCAN Windows driver <a href="https://www.peak-system.com/quick/DrvSetup">here</a>. Please make sure that you include the ‚ÄúPCAN-Basic API‚Äù when you install the software.</p>
</div>
</div>
</div>
</div>
<div id="install" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Install<a href="#install" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please use the following command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">pip</span> install icotronic</span></code></pre></div>
<p>to install the <a href="https://pypi.org/project/icotronic">latest official version of the ICOtronic library from PyPi</a>.</p>
<div id="install-the-package-using-windows-terminal" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Install the Package Using Windows Terminal<a href="#install-the-package-using-windows-terminal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Install (Windows) <a href="https://aka.ms/terminal">Terminal</a> if you have not done so already; On Windows 11 this application should be installed by default.</p></li>
<li><p>Open Terminal</p></li>
<li><p>Copy and paste the following text into the Terminal</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">pip</span> install icotronic</span></code></pre></div></li>
<li><p>Press Return <kbd>‚èé</kbd></p></li>
<li><p>Wait until the install process finished successfully</p></li>
</ol>
</div>
<div id="install-the-development-version-of-icotronic" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Install the Development Version of ICOtronic<a href="#install-the-development-version-of-icotronic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Note:</strong> Please only use the command below, <strong>if you know what you are doing</strong>!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="st">&#39;git+https://github.com/MyTooliT/ICOtronic&#39;</span></span></code></pre></div>

</div>
</div>
</div>
<div id="data-collection" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Data Collection<a href="#data-collection" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The <a href="https://pypi.org/project/icotronic">ICOtronic package</a> provides two different options to collect sensor data with the <a href="https://mytoolit.com/icotronic">ICOtronic system</a>:</p>
<ol style="list-style-type: decimal">
<li>Use the <a href="https://icotronic.readthedocs.io">API</a> to write your own Python scripts: To learn more about this option, please take a look at the <a href="https://icotronic.readthedocs.io">API documentation</a>.</li>
<li>Use the <a href="#icon-cli-tool"><code>icon</code></a> script to collect data: We will describe how to measure some basic data with this script in the text below</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Since ICOn currently only provides very basic functionality for data collection you might be happier using one of the tools below. Both are currently based on an <a href="https://github.com/mytoolit/ICOc">older (deprecated) version of this Python package</a>:</p>
<ul>
<li><a href="https://git.ift.tuwien.ac.at/lab/ift/icotronic/icodaq">ICOdaq</a>: A closed source Electron application for Windows</li>
<li><a href="https://mytoolit.github.io/ICOc/#basic-usage">ICOc</a>: A text based UI for Windows</li>
</ul>
</blockquote>
<div id="sensor-node-identifiers" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Sensor Node Identifiers<a href="#sensor-node-identifiers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To connect to a sensor node (SHA, STH, SMH) you need to know an identifier for the node, which can be one of the following:</p>
<ul>
<li>Bluetooth advertisement <strong>name</strong>: up to 8 characters, no special characters allowed</li>
<li>Bluetooth <strong><a href="https://en.wikipedia.org/wiki/MAC_address">MAC address</a></strong>: 8 Bytes, usually written in <a href="https://en.wikipedia.org/wiki/Hexadecimal">hexadecimal format</a></li>
<li><strong>Node number</strong>: starting with 0, up to the number of available sensor nodes minus one (e.g.¬†for 8 sensor nodes, the maximum sensor node number will be 7)</li>
</ul>
<p>If you do not know any of the above identifiers for your sensor node you can use the command</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div>
<p>to show the available nodes:</p>
<pre><code>ü§ñ Name: Test-STH, Number: 0, MAC Address: 08-6B-D7-01-DE-81, RSSI: -51</code></pre>
<p>In the example above, we see that one sensor node is available with the following identifiers:</p>
<ul>
<li>node number: <code>0</code></li>
<li>name: <code>Test-STH</code></li>
<li>MAC address: <code>08-6B-D7-01-DE-81</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> The last value ‚Äú-51‚Äù of the example output is the current <a href="https://en.wikipedia.org/wiki/Received_signal_strength_indication">received signal strength indication (RSSI)</a>.</p>
</blockquote>
</div>
<div id="collecting-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Collecting Data<a href="#collecting-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After you determined one of the identifiers (name, MAC address, node number) of your sensor node you can use the command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">icon</span> measure</span></code></pre></div>
<p>to collect measurement data. For example, to collect data from an STH with the name ‚ÄúTest-STH‚Äù for 10 seconds you can use the following command:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">--name</span> Test-STH <span class="at">--time</span> 10</span></code></pre></div>
<p>After the measurement took place the command will print some information about the collected data, including the location of the <a href="https://www.hdfgroup.org/solutions/hdf5">HDF5</a> measurement file:</p>
<pre><code>Sample Rate: 9523.81 Hz
Data Loss: 0.0 %
Filepath: Measurement_2025-05-14_15-11-25.hdf5</code></pre>
<p>By default measurement files will be stored in the current working directory with</p>
<ul>
<li>a name starting with the text <code>Measurement</code></li>
<li>followed by a date/time-stamp, and</li>
<li>the extension <code>.hdf5</code>.</li>
</ul>
</div>
<div id="measurement-data" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Measurement Data<a href="#measurement-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p><strong>Note:</strong> ICOn <strong>assumes</strong> that the sensor node always measures <strong>acceleration data</strong> in multiples of the <a href="https://en.wikipedia.org/wiki/Gravity_of_Earth">gravity of earth</a>, commonly referred as <span class="math inline">\(g\)</span> or <span class="math inline">\(g_0\)</span>. While this is true for most of the sensor hardware (such as STHs), some sensor nodes measure other values, e.g.¬†force or temperature. Even in this case the measurement software will (incorrectly) <a href="https://github.com/MyTooliT/ICOtronic/blob/dc636ce2cda8f380aa0f031fc743062820eb3443/mytoolit/measurement/acceleration.py#L50-L51">convert the data into multiples of <span class="math inline">\(g\)</span></a>. We are <strong>working on adding support for configuring the sensor type</strong> in the firmware and the ICOtronic package to <strong>fix this issue</strong>.</p>
</blockquote>
<p>To take a look at the measurement data you can use the tool <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a>.</p>
<blockquote>
<p><strong>Note:</strong> Unfortunately you need to create a free account to download the program. If you do not want to register, then you can try if <a href="http://bugmenot.com/view/hdfgroup.org">one of the accounts listed at BugMeNot</a> works. Another option is to download the application from <a href="https://support.hdfgroup.org/ftp/HDF5/releases/HDF-JAVA/">here</a>. Just click on the folder for the latest version of the application (<code>hdfview-‚Ä¶</code>) and afterwards on the folder <code>bin</code> to see a list of compressed binaries (<code>.zip</code> &amp; <code>.tar.gz</code>) for the different supported operating systems.</p>
</blockquote>
<p>The screenshot below shows a measurement file produced by the ICOtronic library:</p>
<p><img src="Documentation/Pictures/HDFView-File.png" alt="Main Window of HDFView" /></p>
<p>As you can see the table with the name <code>acceleration</code> stores the acceleration data. The screenshot above displays the metadata of the table. The most important meta attributes here are probably:</p>
<ul>
<li><code>Start_Time</code>, which contains the start time of the measurement run in ISO format, and</li>
<li><code>Sensor_Range</code>, which specifies the range of the used acceleration sensor in multiples of earth‚Äôs gravitation (g‚ÇÄ ‚âÖ 9.81 m/s¬≤).</li>
</ul>
<p>After you double click on the acceleration table on the left, HDFView will show you the actual acceleration data:</p>
<p><img src="Documentation/Pictures/HDFView-Table.png" alt="Acceleration Table in HDFView" width="500"/></p>
<p>As you can infer from the <code>x</code> column above the table shows the acceleration measurement data (in multiples of g‚ÇÄ) for a single axis. The table below describes the meaning of the columns:</p>
<table>
<colgroup>
<col width="7%" />
<col width="77%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>counter</td>
<td>A cyclic counter value (0‚Äì255) sent with the acceleration data to recognize lost packets</td>
<td>‚Äì</td>
</tr>
<tr class="even">
<td>timestamp</td>
<td>The timestamp for the measured value in microseconds since the measurement start</td>
<td>Œºs</td>
</tr>
<tr class="odd">
<td>x</td>
<td>Acceleration in the x direction as multiples of earth‚Äôs gravitation</td>
<td>g‚ÇÄ (‚âÖ 9.81 m/s¬≤)</td>
</tr>
</tbody>
</table>
<p>Depending on your sensor and your settings the table might also contain columns for the <code>y</code> and/or <code>z</code> axis.</p>
<p>If you want you can also use HDFView to print a simple graph for your acceleration data. To do that:</p>
<ol style="list-style-type: decimal">
<li>Select the values for the the ordinate (e.g.¬†click on the x column to select all acceleration data for the x axis)</li>
<li>Click on the graph icon in the top left corner</li>
<li>Choose the data for the abscissa (e.g.¬†the timestamp column)</li>
<li>Click on the ‚ÄúOK‚Äù button</li>
</ol>
<p>The screenshot below shows an example of such a graph:</p>
<p><img src="Documentation/Pictures/HDFView-Graph.png" alt="Acceleration Graph in HDFView" /></p>
<p>For a more advanced analysis of the data files you can use our collection of measurement utilities <a href="https://github.com/MyTooliT/ICOlyzer">ICOlyzer</a>.</p>
<div id="adding-custom-metadata" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Adding Custom Metadata<a href="#adding-custom-metadata" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes you also want to add additional data about a measurement. To do that you can also use <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a>. Since the tool opens files in read-only mode by default you need to change the default file access mode to ‚ÄúRead/Write‚Äù first:</p>
<ol style="list-style-type: decimal">
<li>Open <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a></li>
<li>Click on ‚ÄúTools‚Äù ‚Üí ‚ÄúUser Options‚Äù</li>
<li>Select ‚ÄúGeneral Settings‚Äù</li>
<li>Under the text ‚ÄúDefault File Access Mode‚Äù choose ‚ÄúRead/Write‚Äù</li>
<li>Close HDFView</li>
</ol>
<p>Now you should be able to add and modify attributes. For example, to add a revolutions per minute (RPM) value of <code>15000</code> you can use the following steps:</p>
<ol style="list-style-type: decimal">
<li>Open the measurement file in <a href="https://www.hdfgroup.org/downloads/hdfview/">HDFView</a></li>
<li>Click on the table ‚Äúacceleration‚Äù in the left part of the window</li>
<li>In the tab ‚ÄúObject Attribute Info‚Äù on the right, click on the button ‚ÄúAdd attribute‚Äù</li>
<li>Check that ‚ÄúObject List‚Äù contains the value ‚Äú/acceleration‚Äù</li>
<li>Enter the text ‚ÄúRPM‚Äù in the field ‚ÄúName‚Äù</li>
<li>In the field ‚ÄúValue‚Äù enter the text ‚Äú15000‚Äù</li>
<li>The ‚ÄúDatatype Class‚Äù should be set to ‚ÄúINTEGER‚Äù</li>
<li>For the size (in bits) choose a bit length that is large enough to store the value. In our example everything equal to or larger than 16 bits should work.</li>
<li>Optionally you can also check ‚ÄúUnsigned‚Äù, if you are sure that you only want to store positive values</li>
<li>Click the button ‚ÄúOK‚Äù</li>
</ol>
<p><img src="Documentation/Pictures/HDFView-RPM.png" alt="HDFView: RPM Attribute" /></p>
<p>Sometimes you also want to add some general purpose data. For that you can use the ‚ÄúSTRING‚Äù datatype class. For example, to store the text ‚Äúhello world‚Äù in an attribute called ‚ÄúComment‚Äù you can do the following</p>
<ol style="list-style-type: decimal">
<li>Repeat steps 1. ‚Äì 4. from above</li>
<li>Choose ‚ÄúSTRING‚Äù as ‚ÄúDatatype Class‚Äù</li>
<li>Under ‚ÄúArray Size‚Äù choose a length that is large enough to store the text such as ‚Äú1000‚Äù (every size larger than or equal to 11 characters should work)</li>
<li>Click the button ‚ÄúOK‚Äù</li>
</ol>
<p><img src="Documentation/Pictures/HDFView-Comment.png" alt="HDFView: Comment Attribute" /></p>
<p>If you want you can also add multiline text. Since you can not add newlines using <kbd>‚èé</kbd> in HDFView directly, we recommend you open your favorite text editor to write the text and then copy and paste the text into the value field. HDFView will only show the last line of the pasted text. However, after you copy and paste the text into another program you will see that HDFView stored the text including the newlines.</p>

</div>
</div>
</div>
<div id="tutorials" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Tutorials<a href="#tutorials" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="changing-configuration-values" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Changing Configuration Values<a href="#changing-configuration-values" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p><strong>Note:</strong> If you only use the <code>icon</code> command line tool, then you most probably do not need to change the configuration at all.</p>
</blockquote>
<p>All configuration options are currently stored in <a href="https://yaml.org">YAML</a> files (handled by the configuration library <a href="https://www.dynaconf.com">Dynaconf</a>). The <a href="https://github.com/MyTooliT/ICOtronic/blob/main/icotronic/config/config.yaml">default values</a> are stored inside the package itself. If you want to overwrite or extend these values you should create a user configuration file. To do that you can use the command:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">icon</span> config</span></code></pre></div>
<p>which will open the the user configuration in your default text editor. You can then edit this file and save your changes to update the configuration. For a list of available options, please take a look at the <a href="https://github.com/MyTooliT/ICOtronic/blob/main/icotronic/config/config.yaml">default configuration</a>.</p>
<p>Please make sure to not make any mistakes when you edit this file. Otherwise some parts of the ICOtronic library will not work correctly, printing an error message about the (first) incorrect configuration value. In that case the library will also try to open the user configuration file in your standard text editor so you can fix the problem.</p>
</div>
<div id="icon-cli-tool" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> ICOn CLI Tool<a href="#icon-cli-tool" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="help" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Help<a href="#help" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To show the available subcommands and options of <code>icon</code> you can use the option <code>-h</code> or <code>--help</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">icon</span> <span class="at">-h</span></span></code></pre></div>
<p>To show the available options for a certain subcommand add the subcommand before the option. For example, to show the help text for the subcommand <code>measure</code> you can use the following command:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-h</span></span></code></pre></div>
</div>
<div id="listing-available-sensor-nodes" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Listing Available Sensor Nodes<a href="#listing-available-sensor-nodes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To print a list of all available sensor nodes, including their identifiers (name, MAC address, node number), please use the subcommand <code>list</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div>
</div>
<div id="collecting-measurement-data" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Collecting Measurement Data<a href="#collecting-measurement-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To collect and store measurement data from an STH you can uses the subcommand <code>measure</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">icon</span> measure</span></code></pre></div>
<p>By default the command will collect streaming data for 10 seconds for the first measurement channel and store the data in a file starting with the name <code>Measurement</code> and the extension <code>.hdf5</code> in the current working directory.</p>
<div id="specifying-the-sensor-hardware" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Specifying the Sensor Hardware<a href="#specifying-the-sensor-hardware" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>measure</code> subcommand requires that you specify one of the identifiers of a sensor node.</p>
<p>To connect to a sensor node by <strong>name</strong> use the option <code>-n</code> or <code>--name</code>. For example, the command below collects data from the sensor node with the name <code>Test-STH</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-n</span> <span class="st">&#39;Test-STH&#39;</span></span></code></pre></div>
<p>You can also use the MAC address to connect to a certain sensor node with the option <code>-m</code> or <code>--mac-address</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-m</span> <span class="st">&#39;08-6B-D7-01-DE-81&#39;</span></span></code></pre></div>
<p>To connect using the node number use the option <code>-d</code> or <code>--node-number</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-d</span> 0</span></code></pre></div>
</div>
<div id="changing-the-run-time" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Changing the Run Time<a href="#changing-the-run-time" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To change the run time of the measurement you can use the option <code>-t</code>, which takes the runtime in seconds as argument. The command</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-t</span> 300</span></code></pre></div>
<p>for example, changes the runtime to 300 seconds (5 minutes).</p>
</div>
<div id="channel-selection" class="section level4 hasAnchor" number="3.2.3.3">
<h4><span class="header-section-number">3.2.3.3</span> Channel Selection<a href="#channel-selection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To enable the measurement for the first (‚Äúx‚Äù) channel and second (‚Äúy‚Äù) measurement channel for</p>
<ul>
<li>an ‚Äúolder‚Äù STH (Firmware <code>2.x</code>, <code>BGM113</code> chip) or</li>
<li>a ‚Äúnewer‚Äù STH (Firmware <code>3.x</code>, <code>BGM121</code> chip)</li>
</ul>
<p>you can use the following command:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-1</span> 1 <span class="at">-2</span> 2 <span class="at">-3</span> 0</span></code></pre></div>
<p>Here:</p>
<ul>
<li><code>0</code> indicates that you want to disable the specified measurement channel, while</li>
<li>using the same number for the measurement channel (option) and the sensor/hardware channel (argument for the option) specifies that you want to use the specified channel.</li>
</ul>
<p>Since the default value</p>
<ul>
<li>for the option <code>-1</code> is already <code>1</code>, and</li>
<li>for the option <code>-3</code> is already <code>0</code></li>
</ul>
<p>you can also leave out these options to arrive at the shorter command:</p>
<pre><code>icon measure -2 2</code></pre>
<blockquote>
<p><strong>Note:</strong> Due to a problem in the current firmware the amount of <strong>paket loss is much higher</strong>, if you</p>
<ul>
<li>use the standard ADC configuration values, and</li>
<li>enable data transmission for <strong>exactly 2 (channels)</strong>.</li>
</ul>
<p>We strongly recommend you <strong>use either one or three channels</strong>.</p>
</blockquote>
<p>For newer STH versions (Firmware <code>3.x</code>, <code>BGM121</code> chip) or SMHs (Sensory Milling Heads) you can also change the hardware/sensor channel for the first, second and third measurement channel. For example, to select</p>
<ul>
<li>hardware channel 8 for the first measurement channel</li>
<li>hardware channel 1 for the second measurement channel, and</li>
<li>hardware channel 3 for the third measurement channel</li>
</ul>
<p>you can use the following command:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-1</span> 8 <span class="at">-2</span> 1 <span class="at">-3</span> 3</span></code></pre></div>
<p>If you just want to enable/set a measurement channel and use the hardware channel with the same number you can also just leave the argument for the specific measurement channel empty. For example, to use</p>
<ul>
<li>hardware channel 1 for measurement channel 1,</li>
<li>hardware channel 2 for measurement channel 2, and</li>
<li>hardware channel 3 for measurement channel 3</li>
</ul>
<p>you can use the following command:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-1</span> <span class="at">-2</span> <span class="at">-3</span></span></code></pre></div>
<p>or even shorter, since the default value for measurement channel 1 is hardware channel 1:</p>
<pre><code>icon measure -2 -3</code></pre>
</div>
<div id="changing-the-reference-voltage" class="section level4 hasAnchor" number="3.2.3.4">
<h4><span class="header-section-number">3.2.3.4</span> Changing the Reference Voltage<a href="#changing-the-reference-voltage" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For certain sensor nodes you have to change the reference voltage to retrieve a proper measurement value. For example, STHs that use a ¬± 40 g acceleration sensor (<a href="https://www.analog.com/en/products/adxl356.html">ADXL356</a>) require a reference voltage of 1.8 V instead of the usual supply voltage (<code>VDD</code>) of 3.3 V. To select the correct reference voltage for these nodes at startup use the option <code>-v 1.8</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">-v</span> 1.8</span></code></pre></div>
</div>
<div id="changing-the-sampling-rate" class="section level4 hasAnchor" number="3.2.3.5">
<h4><span class="header-section-number">3.2.3.5</span> Changing the Sampling Rate<a href="#changing-the-sampling-rate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can change the sampling rate by modifying the parameters of the ADC (analog digital converter). There are 3 parameters which influence the sampling rate.</p>
<ul>
<li><strong>Prescaler</strong>: Prescaler used by the ADC to get the sample points (<code>-s</code>, <code>--prescaler</code>)</li>
<li><strong>Acquisition Time</strong>: Time the ADC holds a value to get a sampling point (<code>-a</code>, <code>--acquisition</code>)</li>
<li><strong>Oversampling Rate</strong>: Oversampling rate of the ADC (<code>-o</code>, <code>--oversampling</code>)</li>
</ul>
<p>The formula which can be used to calculate the sampling rate can be found in the general ICOtronic system documentation under the section <a href="https://mytoolit.github.io/Documentation/#sampling-rate">‚ÄúSampling Rate‚Äù</a>. Please be aware that the actual sample rate might be slightly lower, even if there is no data loss.</p>
<p>For example, to use a sampling rate of about 2381 Hz you can use the following command:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">icon</span> measure <span class="at">--prescaler</span> 2 <span class="at">--acquisition</span> 8 <span class="at">--oversampling</span> 256</span></code></pre></div>
</div>
</div>
<div id="tutorials:section:sth-renaming" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Renaming a Sensor Node<a href="#tutorials:section:sth-renaming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To change the name of a sensor you can use the subcommand <code>rename</code>. For example, to change the name of the sensor node with the Bluetooth MAC address <code>08-6B-D7-01-DE-81</code> to <code>Test-STH</code> use the following command:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">icon</span> rename <span class="at">-m</span> 08-6B-D7-01-DE-81 Test-STH</span></code></pre></div>
<p>For more information about the command you can use the option <code>-h</code>/<code>--help</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">icon</span> rename <span class="at">-h</span></span></code></pre></div>
</div>
<div id="opening-the-user-configuration" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Opening the User Configuration<a href="#opening-the-user-configuration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To open the user configuration file, you can use the subcommand <code>config</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">icon</span> config</span></code></pre></div>
<p>If the file does not exist yet, then it will be created and filled with the content of the <a href="https://github.com/MyTooliT/ICOtronic/blob/main/icotronic/config/user.yaml">default user configuration</a>. For more information on how to change the configuration, please take a look at the section <a href="#changing-configuration-values">‚ÄúChanging Configuration Values‚Äù</a>.</p>
</div>
<div id="stu-commands" class="section level3 hasAnchor" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> STU Commands<a href="#stu-commands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To list all available STU subcommands, please use the option <code>-h</code> (or <code>--help</code>):</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">icon</span> stu <span class="at">-h</span></span></code></pre></div>
<div id="retrieve-the-bluetooth-stu-mac-address" class="section level4 hasAnchor" number="3.2.6.1">
<h4><span class="header-section-number">3.2.6.1</span> Retrieve the Bluetooth STU MAC Address<a href="#retrieve-the-bluetooth-stu-mac-address" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To retrieve the STU Bluetooth address you can use the following command:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">icon</span> stu mac</span></code></pre></div>
</div>
<div id="reset-stu" class="section level4 hasAnchor" number="3.2.6.2">
<h4><span class="header-section-number">3.2.6.2</span> Reset STU<a href="#reset-stu" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To reset the STU please use the following command:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">icon</span> stu reset</span></code></pre></div>
</div>
<div id="determining-data-loss" class="section level4 hasAnchor" number="3.2.6.3">
<h4><span class="header-section-number">3.2.6.3</span> Determining Data Loss<a href="#determining-data-loss" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Depending on</p>
<ul>
<li>the hardware of the computer and</li>
<li>the used sampling frequency</li>
</ul>
<p>the ICOtronic library might not be able to keep up with the rate of measurement data that is collected by the STU and stored in the buffer of the CAN adapter. The result in this case will be a certain rate of data loss, since the CAN adapter will get rid of old data if it is not collected fast enough.</p>
<p>To minimize the chance of this kind of data loss you can use the command</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="ex">icon</span> dataloss</span></code></pre></div>
<p>to determine the CPU usage and data loss for the current computer at certain sample rates.</p>

</div>
</div>
</div>
</div>
<div id="code-examples" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Code Examples<a href="#code-examples" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>For information on how to write your own code including sample code please take a look at the <a href="https://icotronic.readthedocs.io">API documentation</a>.</p>

</div>
<div id="virtualization" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Virtualization<a href="#virtualization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>You can also use the ICOtronic package with various virtualization software. For that to work you have to make sure that (at least) the PEAK CAN adapter is attached to the virtual guest operating system. For some virtualization software you might have to install additional software for that to work. For example, <a href="https://www.virtualbox.org">VirtualBox</a> requires that you install the VirtualBox Extension Pack before you can use USB 2 and USB 3 devices.</p>
<blockquote>
<p><strong>Note:</strong> Please be advised that the <a href="https://www.virtualbox.org/wiki/Licensing_FAQ"><strong>VirtualBox Extension Pack is paid software</strong></a> even though you can download and use it without any license key. <strong><a href="https://www.reddit.com/r/sysadmin/comments/d1ttzp/oracle_is_going_after_companies_using_virtualbox/">Oracle might come after you, if you do not pay for the license</a></strong>, even if you use the Extension Pack in an educational setting.</p>
</blockquote>
<p>The table below shows some of the virtualization software we tried and that worked (when we tested it).</p>
<table>
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="7%" />
<col width="5%" />
<col width="8%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th>Virtualization Software</th>
<th>Host OS</th>
<th>Host Architecture</th>
<th>Guest OS</th>
<th>Guest Architecture</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Ubuntu 20.04</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Windows 10</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="odd">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>ARM64</code></td>
<td>Fedora 36</td>
<td><code>ARM64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.parallels.com">Parallels Desktop</a></td>
<td>macOS</td>
<td><code>ARM64</code></td>
<td>Windows 11</td>
<td><code>ARM64</code>, <code>x64</code></td>
<td>JLink (and hence Simplicity Commander) only works with <a href="https://wiki.segger.com/J-Link_on_Windows_ARM">programming adapters that support WinUSB</a></td>
</tr>
<tr class="odd">
<td><a href="https://www.virtualbox.org">VirtualBox</a></td>
<td>macOS</td>
<td><code>x64</code></td>
<td>Windows 10</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="even">
<td><a href="https://www.virtualbox.org">VirtualBox</a></td>
<td>Windows</td>
<td><code>x64</code></td>
<td>Fedora 36</td>
<td><code>x64</code></td>
<td></td>
</tr>
<tr class="odd">
<td><a href="http://aka.ms/wsl">WSL 2</a></td>
<td>Windows</td>
<td><code>x64</code></td>
<td>Ubuntu 22.04</td>
<td><code>x64</code></td>
<td></td>
</tr>
</tbody>
</table>
<div id="windows-subsystem-for-linux-2" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Windows Subsystem for Linux 2<a href="#windows-subsystem-for-linux-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using ICOtronic in the WSL 2 currently <a href="https://github.com/microsoft/WSL/issues/5533">requires using a custom Linux kernel</a>. We <strong>would not recommend</strong> using ICOtronic with this type of virtualization software, since the setup requires quite some amount of work and time. Nevertheless the steps below should show you how you can use the PEAK CAN adapter and hence the ICOtronic package with WSL 2.</p>
<ol style="list-style-type: decimal">
<li><p>Install WSL 2 (Windows Shell):</p>
<pre><code>wsl --install</code></pre></li>
<li><p>Install Ubuntu 22.04 VM (Windows Shell):</p>
<ol style="list-style-type: decimal">
<li><p>Install <a href="https://apps.microsoft.com/store/detail/ubuntu-2204-lts/9PN20MSR04DW">Ubuntu 22.04 from the Microsoft Store</a></p></li>
<li><p>Open the Ubuntu 22.04 application</p>
<ol style="list-style-type: decimal">
<li>Choose a user name</li>
<li>Choose a password</li>
</ol></li>
<li><p>Execute the following commands in a Powershell session</p>
<pre class="pwsh"><code>wsl --setdefault Ubuntu-22.04
wsl --set-version Ubuntu-22.04 2</code></pre>
<p>The second command might fail, if <code>Ubuntu-22.04</code> already uses WSL 2. In this case please just ignore the error message.</p></li>
</ol></li>
<li><p><a href="https://github.com/dorssel/usbipd-win/wiki/WSL-support#building-your-own-usbip-enabled-wsl-2-kernel">Create Custom Kernel</a></p>
<p>Windows Shell:</p>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Linux) username (e.g.¬†<code>rene</code>)</p>
</blockquote>
<pre class="pwsh"><code>cd ~/Documents
mkdir WSL
cd WSL
wsl --export Ubuntu-22.04 CANbuntu.tar
wsl --import CANbuntu CANbuntu CANbuntu.tar
wsl --distribution CANbuntu --user &lt;user&gt;</code></pre>
<p>Linux Shell:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="fu">sudo</span> apt upgrade <span class="at">-y</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> bc build-essential flex bison libssl-dev libelf-dev <span class="dt">\</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>                    libncurses-dev autoconf libudev-dev libtool dwarves</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/microsoft/WSL2-Linux-Kernel.git</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="bu">cd</span> WSL2-Linux-Kernel</span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="fu">uname</span> <span class="at">-r</span> <span class="co"># 5.15.74.2-microsoft-standard-WSL2 ‚Üí branch ‚Ä¶5.15.y</span></span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a><span class="fu">git</span> checkout linux-msft-wsl-5.15.y</span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a><span class="fu">cat</span> /proc/config.gz <span class="kw">|</span> <span class="fu">gunzip</span> <span class="op">&gt;</span> .config</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a><span class="fu">make</span> menuconfig</span></code></pre></div>
<p>Make sure the following features are enabled:</p>
<ul>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB announce new devices</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB Modem (CDC ACM) support</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB/IP</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB/IP</code> ‚Üí <code>VHCI HCD</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB Serial Converter Support</code></li>
<li><code>Device Drivers</code> ‚Üí <code>USB Support</code> ‚Üí <code>USB Serial Converter Support</code> ‚Üí <code>USB FTDI Single port Serial Driver</code></li>
</ul>
<p>Enable the following features:</p>
<ul>
<li><code>Networking support</code> ‚Üí <code>CAN bus subsystem support</code></li>
<li><code>Networking support</code> ‚Üí <code>CAN bus subsystem support</code> ‚Üí <code>Raw CAN Protocol</code></li>
<li><code>Networking support</code> ‚Üí <code>CAN bus subsystem support</code> ‚Üí <code>CAN device drivers</code> ‚Üí <code>Virtual Local CAN Interface</code></li>
<li><code>Networking support</code> ‚Üí <code>CAN bus subsystem support</code> ‚Üí <code>CAN device drivers</code> ‚Üí <code>Serial / USB serial CAN Adaptors (slcan)</code></li>
<li><code>Networking support</code> ‚Üí <code>CAN bus subsystem support</code> ‚Üí <code>CAN device drivers</code> ‚Üí <code>CAN USB Interfaces</code> ‚Üí <code>PEAK PCAN-USB/USB Pro interfaces for CAN 2.0b/CAN-FD</code></li>
</ul>
<p>Save the modified kernel configuration.</p>
<p>Linux Shell:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">touch</span> .scmversion</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a><span class="fu">sudo</span> make modules_install</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a><span class="fu">sudo</span> make install</span></code></pre></div></li>
<li><p>Install <code>usbipd-win</code> (Linux Shell):</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="bu">cd</span> tools/usb/usbip</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="ex">./autogen.sh</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="ex">./configure</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="fu">sudo</span> make install</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a><span class="fu">sudo</span> cp libsrc/.libs/libusbip.so.0 /lib/libusbip.so.0</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="fu">sudo</span> apt-get install <span class="at">-y</span> hwdata</span></code></pre></div></li>
<li><p>Copy image (Linux Shell):</p>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g.¬†<code>rene</code>)</p>
</blockquote>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="bu">cd</span> ~/WSL2-Linux-Kernel</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="fu">cp</span> arch/x86/boot/bzImage /mnt/c/Users/<span class="op">&lt;</span>user<span class="op">&gt;</span>/Documents/WSL/canbuntu-bzImage</span></code></pre></div></li>
<li><p>Create <code>.wslconfig</code> in (root of) Windows user directory and store the following text:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="kw">[wsl2]</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="dt">kernel</span><span class="ot">=</span><span class="st">c:\\users\\&lt;user&gt;\\Documents\\WSL\\canbuntu-bzImage</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g.¬†<code>rene</code>)</p>
</blockquote></li>
<li><p>Set default distribution (Windows Shell)</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">wsl</span> <span class="at">--setdefault</span> CANbuntu</span></code></pre></div></li>
<li><p>Shutdown and restart WSL (Windows Shell):</p>
<pre class="pwsh"><code>wsl --shutdown
wsl -d CANbuntu --cd &quot;~&quot;</code></pre></li>
<li><p>Change default user of WSL distro (Linux Shell)</p>
<pre><code>sudo nano /etc/wsl.conf</code></pre>
<p>Insert the following text:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="kw">[user]</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="dt">default</span><span class="ot">=</span><span class="st">&lt;user&gt;</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Please replace <code>&lt;user&gt;</code> with your (Windows) username (e.g.¬†<code>rene</code>)</p>
</blockquote>
<p>Save the file and exit <code>nano</code>:</p>
<ol style="list-style-type: decimal">
<li><kbd>Ctrl</kbd> + <kbd>O</kbd></li>
<li><kbd>‚èé</kbd></li>
<li><kbd>Ctrl</kbd> + <kbd>X</kbd>)</li>
</ol></li>
<li><p>Restart WSL: See step <code>8</code></p></li>
<li><p>Install <code>usbipd</code> (Windows Shell):</p>
<pre class="pwsh"><code>winget install usbipd</code></pre></li>
<li><p>Attach CAN-Adapter to Linux VM (Windows Shell)</p>
<pre class="pwsh"><code>usbipd wsl list
# ‚Ä¶
# 5-3    0c72:0012  PCAN-USB FD                      Not attached
# ‚Ä¶
usbipd wsl attach -d CANbuntu --busid 5-3
usbipd wsl list
# ‚Ä¶
# 5-3    0c72:0012  PCAN-USB FD                      Attached - CANbuntu
# ‚Ä¶</code></pre></li>
<li><p>Check for PEAK CAN adapter in Linux (Optional, Linux Shell):</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">dmesg</span> <span class="kw">|</span> <span class="fu">grep</span> peak_usb</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="co"># ‚Ä¶</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="co"># peak_usb 1-1:1.0: PEAK-System PCAN-USB FD v1 fw v3.2.0 (1 channels)</span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a><span class="co"># ‚Ä¶</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a><span class="ex">lsusb</span></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a><span class="co"># ‚Ä¶</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a><span class="co"># Bus 001 Device 002: ID 0c72:0012 PEAK System PCAN-USB FD</span></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="co"># ‚Ä¶</span></span></code></pre></div></li>
<li><p>Add virtual link for CAN device (Linux Shell)</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 type can bitrate 1000000</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 up</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: If the commands above fail with the error message:</p>
<blockquote>
<p>RTNETLINK answers: Connection timed out</p>
</blockquote>
<p>then please disconnect and connect the USB CAN adapter. After that attach it to the Linux VM again (see step <code>12</code>).</p>
</blockquote></li>
<li><p>Install <code>pip</code> (Linux Shell):</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> python3-pip</span></code></pre></div></li>
<li><p>Install ICOtronic (Linux Shell)</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="fu">mkdir</span> Documents</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a><span class="bu">cd</span> Documents</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/MyTooliT/ICOtronic.git</span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a><span class="bu">cd</span> ICOtronic</span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> pip install <span class="at">--prefix</span><span class="op">=</span><span class="va">$(</span><span class="ex">python3</span> <span class="at">-m</span> site <span class="at">--user-base</span><span class="va">)</span> <span class="at">-e</span> .</span></code></pre></div></li>
<li><p>Run a script to test that everything works as expected (Linux Shell)</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div>
<p>If the command above fails with the message</p>
<pre><code>Command &#39;icon&#39; not found‚Ä¶</code></pre>
<p>then you might have to logout and login into the WSL session again before you execute <code>icon list</code> again.</p></li>
</ol>
<blockquote>
<p><strong>Notes:</strong></p>
<ul>
<li>You only need to repeat steps</li>
<li><code>12</code>: attach the CAN adapter to the VM in Windows and</li>
<li><code>14</code>: create the link for the CAN device in Linux</li>
</ul>
<p>after you set up everything properly once.</p>
<ul>
<li>Unfortunately <a href="#introduction:section:pcan-driver:linux">configuring the CAN interface automatically</a> does not seem to work (reliably) on WSL yet</li>
</ul>
</blockquote>

</div>
</div>
<div id="containerization" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Containerization<a href="#containerization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="docker-on-linux" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Docker on Linux<a href="#docker-on-linux" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The text below shows how you can use (code of) the ICOtronic package in a Docker container on a <strong>Linux host</strong>. The description on how to move the interface of the Docker container is an adaption of an <a href="https://chemnitzer.linux-tage.de/2021/de/programm/beitrag/210">article/video from the ‚ÄúChemnitzer Linux-Tage‚Äù</a>.</p>
<div id="creating-a-docker-image" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Creating a Docker Image<a href="#creating-a-docker-image" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create a Docker image that contains ICOtronic just install the package with <code>pip</code> inside your <code>Dockerfile</code>. We recommend that you use a virtual environment to install the package. For an example, please take a look at our <a href="https://github.com/MyTooliT/ICOtronic/blob/main/Docker/Dockerfile"><code>Dockerfile</code></a>.</p>
</div>
<div id="building-the-docker-image" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Building the Docker Image<a href="#building-the-docker-image" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you do not want to create a <code>Dockerfile</code> yourself, you can build an image based on our Docker example file. To do that, please run the following command in the root of the repository:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> mytoolit/icotronic <span class="at">-f</span> Docker/Dockerfile .</span></code></pre></div>
</div>
<div id="using-icotronic-in-the-docker-container" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Using ICOtronic in the Docker Container<a href="#using-icotronic-in-the-docker-container" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Run the container <strong>(Terminal 1)</strong></p>
<ol style="list-style-type: decimal">
<li><p>Open a new terminal window</p></li>
<li><p>Open a shell in the Docker container</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">--name</span> icotronic mytoolit/icotronic</span></code></pre></div></li>
</ol></li>
<li><p>Move the CAN interface into the network space of the Docker container <strong>(Terminal 2)</strong></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">DOCKERPID</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">docker</span> inspect <span class="at">-f</span> <span class="st">&#39;{{ .State.Pid }}&#39;</span> icotronic<span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="fu">sudo</span> ip link set can0 netns <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="fu">sudo</span> nsenter <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span> <span class="at">-n</span> ip link set can0 type can bitrate 1000000</span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a><span class="fu">sudo</span> nsenter <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$DOCKERPID</span><span class="st">&quot;</span> <span class="at">-n</span> ip link set can0 up</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Alternatively you can also add the option <code>--network host</code> to the Docker command from step 1. Please check out the <a href="https://docs.docker.com/engine/network/drivers/host/">Docker documentation</a> to learn more about the consequences of using this option.</p>
</blockquote></li>
<li><p>Run a test command in Docker container <strong>(Terminal 1)</strong> e.g.:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="ex">icon</span> list</span></code></pre></div></li>
</ol>

</div>
</div>
</div>
<div id="troubleshooting" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Troubleshooting<a href="#troubleshooting" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="import-errors" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Import Errors<a href="#import-errors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If <a href="#icon-cli-tool"><code>icon</code></a> fails with an error message that looks similar to the following text on Windows:</p>
<pre><code>Traceback (most recent call last):
‚Ä¶
    from numexpr.interpreter import MAX_THREADS, use_vml, __BLOCK_SIZE1__
ImportError: DLL load failed while importing interpreter: The specified module could not be found.

DLL load failed while importing interpreter: The specified module could not be found.</code></pre>
<p>then you probably need to install the <a href="https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist">‚ÄúMicrosoft Visual C++ Redistributable package‚Äù</a>. You can download the latest version</p>
<ul>
<li>for the <code>x64</code> architecture, i.e.¬†for AMD and Intel CPUs, <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe">here</a> and</li>
<li>for the <code>ARM64</code> architecture <a href="https://aka.ms/vs/17/release/vc_redist.arm64.exe">here</a>.</li>
</ul>
</div>
<div id="insufficient-rights" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Insufficient Rights<a href="#insufficient-rights" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>If you do not have sufficient rights</strong> to install the package you can also try to install the package in the user package folder:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--user</span> icotronic</span></code></pre></div>
</div>
<div id="introduction:section:unable-to-locate-hdf5" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Unable to Locate HDF5<a href="#introduction:section:unable-to-locate-hdf5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The installation of the ICOtronic package might fail with an error message that looks like this:</p>
<pre><code>‚Ä¶ implicit declaration of function &#39;H5close&#39;</code></pre>
<p>If you uses <a href="https://brew.sh">Homebrew</a> on an Apple Silicon based Mac you can use the <a href="https://stackoverflow.com/questions/73029883/could-not-find-hdf5-installation-for-pytables-on-m1-mac">following commands to fix this problem</a>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="ex">pip</span> uninstall <span class="at">-y</span> tables</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a><span class="ex">brew</span> install hdf5 c-blosc2 lzo bzip2</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a><span class="bu">export</span> <span class="va">BLOSC_DIR</span><span class="op">=</span>/opt/homebrew/opt/c-blosc</span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a><span class="bu">export</span> <span class="va">BZIP2_DIR</span><span class="op">=</span>/opt/homebrew/opt/bzip2</span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a><span class="bu">export</span> <span class="va">LZO_DIR</span><span class="op">=</span>/opt/homebrew/opt/lzo</span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a><span class="bu">export</span> <span class="va">HDF5_DIR</span><span class="op">=</span>/opt/homebrew/opt/hdf5</span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--no-cache-dir</span> tables</span></code></pre></div>
</div>
<div id="hdf5-library-not-loaded" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> HDF5 Library Not Loaded<a href="#hdf5-library-not-loaded" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If <a href="#icon-cli-tool"><code>icon</code></a> fails with an error message that looks like this on macOS:</p>
<blockquote>
<p><code>Library not loaded: /opt/homebrew/opt/hdf5/lib/libhdf5.‚Ä¶.dylib</code></p>
</blockquote>
<p>In that case you might have installed an outdated cached version of <a href="https://www.pytables.org">PyTables</a>. You should be able to fix this issue using the same steps as described <a href="#introduction:section:unable-to-locate-hdf5">above</a>.</p>
</div>
<div id="unable-to-open-openblas-library" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Unable to open OpenBLAS library<a href="#unable-to-open-openblas-library" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If <a href="#icon-cli-tool"><code>icon</code></a> fails with the error message:</p>
<blockquote>
<p>ImportError: libopenblas.so.0: cannot open shared object file: No such file or directory</p>
</blockquote>
<p>on <a href="http://www.raspbian.org">Raspbian</a> (or some other GNU/Linux version based on Debian) then you probably need to install the <a href="http://www.openblas.net">OpenBLAS</a> library:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libopenblas-dev</span></code></pre></div>
</div>
<div id="unknown-command" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Unknown Command<a href="#unknown-command" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If <code>pip install</code> prints <strong>warnings about the path</strong> that look like this:</p>
<blockquote>
<p>The script ‚Ä¶ is installed in <code>'‚Ä¶\Scripts'</code> which is not on PATH.</p>
</blockquote>
<p>then please add the text between the single quotes (without the quotes) to your <a href="https://en.wikipedia.org/wiki/PATH_(variable)">PATH environment variable</a>. Here <code>‚Ä¶\Scripts</code> is just a placeholder. Please use the value that <code>pip install</code> prints on your machine. If</p>
<ul>
<li>you used the <a href="https://www.python.org/downloads">installer from the Python website</a> (and checked ‚ÄúAdd Python to PATH‚Äù) or</li>
<li>you used <a href="https://docs.microsoft.com/en-us/windows/package-manager/winget/">winget</a></li>
</ul>
<p>to install Python, then the warning above should not appear. On the other hand, the <strong>Python version from the <a href="https://www.microsoft.com/en-us/store/apps/windows">Microsoft Store</a> might not add the <code>Scripts</code> directory</strong> to your path.</p>

</div>
</div>
<div id="development" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Development<a href="#development" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="install-1" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Install<a href="#install-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can use the instructions below, if you want to work on the code of the ICOtronic package, i.e.¬†add additional features or fix bugs.</p>
<ol style="list-style-type: decimal">
<li><p>Clone <a href="https://github.com/MyTooliT/ICOtronic">the repository</a> to a directory of your choice. You can either use the <a href="https://git-scm.com/downloads">command line tool <code>git</code></a>:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/MyTooliT/ICOtronic.git</span></code></pre></div>
<p>or one of the many available <a href="https://git-scm.com/downloads/guis">graphical user interfaces for Git</a> to do that.</p></li>
<li><p>Install ICOtronic with <a href="https://python-poetry.org">Poetry</a></p>
<ol style="list-style-type: decimal">
<li><p>Change your working directory to the (root) directory of the cloned repository</p></li>
<li><p>Install ICOtronic:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="ex">poetry</span> lock <span class="kw">&amp;&amp;</span> <span class="ex">poetry</span> install <span class="at">--all-extras</span></span></code></pre></div>
<blockquote>
<p><strong>Notes:</strong></p>
<ul>
<li>The command above will install the package in a virtual environment.</li>
<li>You need to prefix commands, such as <code>icon</code> with the command <code>poetry run</code> (e.g.¬†<code>poetry run icon</code>) to execute it in this virtual environment.</li>
<li>Using <code>poetry run</code> will only work in the root folder of the repository (that contains <code>pyproject.toml</code>).</li>
</ul>
</blockquote></li>
</ol></li>
<li><p>Install other required tools (for tests)</p>
<ul>
<li><p><code>hdf5</code>: For the command line tool <code>h5dump</code> (Linux/macOS). You can install hdf5 via <a href="https://brew.sh">Homebrew</a>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="ex">brew</span> install hdf5</span></code></pre></div></li>
</ul></li>
</ol>
</div>
<div id="style" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Style<a href="#style" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please use the guidelines from <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a>. For code formatting we currently use <a href="https://github.com/psf/black">Black</a>, which should format code according to PEP 8 by default.</p>
<p>To format the whole code base you can use the following command in the root of the repository:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="ex">poetry</span> black .</span></code></pre></div>
<p>For development we recommend that you use a tool or plugin that reformats your code with Black every time you save. This way we can ensure that we use a consistent style for the whole code base.</p>
</div>
<div id="tests" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Tests<a href="#tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following text describes some of the measures we should take to keep the software stable:</p>
<ul>
<li><p>Please only push your changes to the <code>main</code> branch, if you think there are no new bugs or regressions. The <code>main</code> branch <strong>should always contain a working version of the software</strong>.</p></li>
<li><p>Please <strong>always run</strong> the <strong>automatic test</strong> (<code>make run</code>) for <strong>every supported OS</strong> (Linux, macOS, Windows) before you push to the <code>main</code> branch.</p></li>
</ul>
<div id="code-checks" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Code Checks<a href="#code-checks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="flake8" class="section level4 hasAnchor" number="8.3.1.1">
<h4><span class="header-section-number">8.3.1.1</span> Flake8<a href="#flake8" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We check the code with <a href="https://flake8.pycqa.org">Flake8</a>. Please use the following command in the root of the repository to make sure you did not add any code that introduces warnings:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="ex">poetry</span> run flake8</span></code></pre></div>
</div>
<div id="mypy" class="section level4 hasAnchor" number="8.3.1.2">
<h4><span class="header-section-number">8.3.1.2</span> mypy<a href="#mypy" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To check the type hint in the code base we use the static code checker <a href="https://mypy.readthedocs.io">mypy</a>. Please use the following command in the root of the repository to check the code base for type problems:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="ex">poetry</span> run mypy icotronic</span></code></pre></div>
</div>
<div id="pylint" class="section level4 hasAnchor" number="8.3.1.3">
<h4><span class="header-section-number">8.3.1.3</span> Pylint<a href="#pylint" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We currently use <a href="https://github.com/PyCQA/pylint">Pylint</a> to check the code:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="ex">poetry</span> run pylint .</span></code></pre></div>
</div>
</div>
<div id="automatic-tests" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Automatic Tests<a href="#automatic-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="usage" class="section level5 hasAnchor" number="8.3.2.0.1">
<h5><span class="header-section-number">8.3.2.0.1</span> Usage<a href="#usage" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Please run the following command in the root of the repository:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="ex">poetry</span> run pytest <span class="at">-v</span></span></code></pre></div>
<p>and make sure that it reports no test failures.</p>
</div>
</div>
<div id="manual-tests" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Manual Tests<a href="#manual-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The text below specifies the manual test that should be executed before we <a href="#development:section:release">release a new version of the ICOtronic package</a>. Please note that the tests assume that you more or less use the <a href="https://github.com/MyTooliT/ICOtronic/blob/main/icotronic/config/config.yaml">default configuration values</a>.</p>
<div id="check-the-performance-of-the-library" class="section level5 hasAnchor" number="8.3.3.0.1">
<h5><span class="header-section-number">8.3.3.0.1</span> Check the Performance of the Library<a href="#check-the-performance-of-the-library" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ol style="list-style-type: decimal">
<li><p>Open your favorite terminal application and change your working directory to the root of the repository</p></li>
<li><p>Remove HDF5 files from the repository:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="fu">rm</span> <span class="pp">*</span>.hdf5</span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> You can ignore errors about ‚Äúno matches for wildcard‚Äù on Linux and macOS. This message just tells you that there is no file with the extension <code>hdf5</code> in the current directory.</p>
</blockquote></li>
<li><p>Check that no HDF5 files exist in the repository. The following command should not produce any output:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.hdf5</span></code></pre></div></li>
<li><p>Give your test STH the <a href="#tutorials:section:sth-renaming">name</a> ‚ÄúTest-STH‚Äù</p></li>
<li><p>Run the following command</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="ex">poetry</span> run icon measure <span class="at">-t</span> 300 <span class="at">-n</span> Test-STH</span></code></pre></div>
<ul>
<li>The command should not print any <strong>no error messages</strong>.</li>
<li>The <strong>data loss must be below 1 %</strong>.</li>
</ul></li>
<li><p>Check that the repo now contains a HDF5 (<code>*.hdf5</code>) file</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.hdf5</span></code></pre></div></li>
<li><p>Open the file in <a href="#measurement-data">HDFView</a></p></li>
<li><p>Check that the timestamp of the last value in the <code>acceleration</code> table has <strong>approximately the value <code>30 000 000</code></strong> (all values above <code>29 900 000</code> should be fine).</p></li>
</ol>
</div>
</div>
<div id="combined-checks-tests" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Combined Checks &amp; Tests<a href="#combined-checks-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While you need to execute some test for the ICOtronic package manually, other tests and checks can be automated.</p>
<blockquote>
<p><strong>Note:</strong> For the text below we assume that you installed <a href="https://en.wikipedia.org/wiki/Make_(software)#Makefile"><code>make</code></a> on your machine.</p>
</blockquote>
<p>To run all checks, the STH test and the STU test use the following <code>make</code> command:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">make</span> run</span></code></pre></div>
</div>
</div>
<div id="development:section:release" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Release<a href="#development:section:release" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Check that the <a href="https://github.com/MyTooliT/ICOtronic/actions"><strong>CI jobs</strong> for the <code>main</code> branch finished successfully</a></p></li>
<li><p>Check that the most recent <a href="https://app.readthedocs.org/projects/icotronic/">‚ÄúRead the Docs‚Äù build of the documentation ran successfully</a></p></li>
<li><p>Check that the <strong>checks and tests</strong> run without any problems on <strong>Linux</strong>, <strong>macOS</strong> and <strong>Windows</strong></p>
<ol style="list-style-type: decimal">
<li><p>Set the value of <code>sth</code> ‚Üí <code>status</code> in the <a href="#changing-configuration-values">configuration</a> to <code>Epoxied</code></p></li>
<li><p>Execute the command:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">make</span> run</span></code></pre></div>
<p>in the root of the repository</p></li>
</ol></li>
<li><p>Execute the <strong><a href="#manual-tests">manual tests</a></strong> in Windows and check that everything works as expected.</p></li>
<li><p>Update the release notes:</p>
<ol style="list-style-type: decimal">
<li><p>Open the <a href="Releases">release notes</a> for the latest version</p></li>
<li><p>Replace links with a permanent version:</p>
<p>For example instead of</p>
<ul>
<li><code>../../something.txt</code> use</li>
<li><code>https://github.com/MyTooliT/ICOtronic/blob/REVISION/something.txt</code>,</li>
</ul>
<p>where <code>REVISION</code> is the latest version of the main branch (e.g.¬†<code>8568893f</code> for version <code>1.0.5</code>)</p></li>
<li><p>Commit your changes</p></li>
</ol></li>
<li><p>Change the version number and commit your changes (please replace <code>&lt;VERSION&gt;</code> with the version number e.g.¬†<code>1.0.5</code>):</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="ex">poetry</span> version <span class="op">&lt;</span>VERSION<span class="op">&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">icotronic_version</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">poetry</span> version <span class="at">-s</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-a</span> <span class="at">-m</span> <span class="st">&quot;Release: Release version </span><span class="va">$icotronic_version</span><span class="st">&quot;</span></span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a><span class="fu">git</span> tag <span class="st">&quot;</span><span class="va">$icotronic_version</span><span class="st">&quot;</span></span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a><span class="fu">git</span> push <span class="kw">&amp;&amp;</span> <span class="fu">git</span> push <span class="at">--tags</span></span></code></pre></div>
<p><strong>Note:</strong> <a href="https://github.com/MyTooliT/ICOtronic/actions">GitHub Actions</a> will publish a package based on the tagged commit and upload it to <a href="https://pypi.org/project/icotronic/">PyPi</a>.</p></li>
<li><p>Create a new release <a href="https://github.com/MyTooliT/ICOtronic/releases/new">here</a></p>
<ol style="list-style-type: decimal">
<li>Insert the version number (e.g.¬†<code>1.0.5</code>) into the tag field</li>
<li>For the release title use ‚ÄúVersion <VERSION>‚Äù, where <code>&lt;VERSION&gt;</code> specifies the version number (e.g.¬†‚ÄúVersion 1.0.5‚Äù)</li>
<li>Paste the release notes for the lastest release into the main text field</li>
<li>Click on ‚ÄúPublish Release‚Äù</li>
</ol>
<p><strong>Note:</strong> Alternatively you can also use the <a href="https://cli.github.com"><code>gh</code></a> command:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="ex">gh</span> release create</span></code></pre></div>
<p>to create the release notes.</p></li>
<li><p>Close the <a href="https://github.com/MyTooliT/ICOtronic/milestones">milestone</a> for the latest release number</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": null,
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Documentation.pdf", "Documentation.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "none",
    "scroll_highlight": true
  },
  "toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
